@model List<EMPManegment.EntityModels.ViewModels.TaskModels.TaskDetailsView>
@using EMPManegment.Web.Models;
@inject IHttpContextAccessor Accessor;
@inject UserSession _userSession
@{
    ViewData["Title"] = "AllTaskDetails";
    Layout = "~/Views/Shared/_HomeLayout.cshtml";
}

<input type="hidden" class="form-control" id="txtprojectid" value="@UserSession.ProjectId" style="border:hidden;" />
<!-- start page title -->
<div class="row" style="margin-top:80px;">
    <div class="col-12">
        <div class="page-title-box d-sm-flex align-items-center justify-content-between">
            <h4 class="mb-sm-0">Task List</h4>

            <div class="page-title-right">
                <ol class="breadcrumb m-0">
                    <li class="breadcrumb-item"><a href="javascript: void(0);">Tasks</a></li>
                    <li class="breadcrumb-item active">Tasks List</li>
                </ol>
            </div>

        </div>
    </div>
</div>
<!-- end page title -->
<div class="row">
    <div class="col-xxl-3 col-sm-6">
        <div class="card card-animate">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h6>Total Tasks</h6>
                        <h2 class="mt-4 ff-secondary fw-semibold">
                            <span class="counter-value" id="Totaltask">
                            </span>
                        </h2>
                        <p class="mb-0 text-muted">
                            <span class="badge bg-light text-success mb-0">
                                <i class="ri-arrow-up-line align-middle"></i> 17.32 %
                            </span> vs. previous month
                        </p>
                    </div>
                    <div>
                        <div class="avatar-sm flex-shrink-0">
                            <span class="avatar-title bg-primary-subtle text-primary rounded-circle fs-4">
                                <i class="bx bx-body"></i>
                            </span>
                        </div>
                    </div>
                </div>
            </div><!-- end card body -->
        </div> <!-- end card-->
    </div>
    <!--end col-->
    <div class="col-xxl-3 col-sm-6">
        <div class="card card-animate">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h6>Pending Tasks</h6>
                        <h2 class="mt-4 ff-secondary fw-semibold">
                            <span class="counter-value" id="Pendingtask"></span>
                        </h2>
                        <p class="mb-0 text-muted">
                            <span class="badge bg-light text-danger mb-0">
                                <i class="ri-arrow-down-line align-middle"></i> 0.87 %
                            </span> vs. previous month
                        </p>
                    </div>
                    <div>
                        <div class="avatar-sm flex-shrink-0">
                            <span class="avatar-title bg-primary-subtle text-primary rounded-circle fs-4">
                                <i class="mdi mdi-timer-sand"></i>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            <!-- end card body -->
        </div>
    </div>
    <!--end col-->
    <div class="col-xxl-3 col-sm-6">
        <div class="card card-animate">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h6>Working Tasks</h6>
                        <h2 class="mt-4 ff-secondary fw-semibold">
                            <span class="counter-value" id="Workingtask"></span>
                        </h2>
                        <p class="mb-0 text-muted">
                            <span class="badge bg-light text-danger mb-0">
                                <i class="ri-arrow-down-line align-middle"></i> 2.52 %
                            </span> vs. previous month
                        </p>
                    </div>
                    <div>
                        <div class="avatar-sm flex-shrink-0">
                            <span class="avatar-title bg-primary-subtle text-primary rounded-circle fs-4">
                                <i class="ri-funds-box-fill"></i>
                            </span>
                        </div>
                    </div>
                </div>
            </div><!-- end card body -->
        </div>
    </div>
    <!--end col-->
    <div class="col-xxl-3 col-sm-6">
        <div class="card card-animate">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h6>Completed Tasks</h6>
                        <h2 class="mt-4 ff-secondary fw-semibold">
                            <span class="counter-value" id="Completetask"></span>
                        </h2>
                        <p class="mb-0 text-muted">
                            <span class="badge bg-light text-success mb-0">
                                <i class="ri-arrow-up-line align-middle"></i> 0.63 %
                            </span> vs. previous month
                        </p>
                    </div>
                    <div>
                        <div class="avatar-sm flex-shrink-0">
                            <span class="avatar-title bg-primary-subtle text-primary rounded-circle fs-4">
                                <i class="ri-checkbox-circle-line"></i>
                            </span>
                        </div>
                    </div>
                </div>
            </div><!-- end card body -->
        </div>
    </div>
    <!--end col-->
</div>
<!--end row-->
<div class="card">
    <div class="card-header">
        <div class="d-flex align-items-center">
            <h5 class="card-title mb-0 flex-grow-1">All Tasks</h5>
            @if (UserSession.FormPermisionData.Any(a => a.FormName == "Tasks List" && (a.Add == true)))
            {

                <div class="flex-shrink-0">
                    <div class="d-flex flex-wrap gap-2">
                        <button class="btn btn-block btn-warning btn-md" data-bs-toggle="modal" onclick="showadddetails()"><i class="ri-add-line align-bottom me-1"></i>Task</button>
                        <button class="btn text-danger" id="remove-actions" onClick="deleteMultiple()"><i class="fas fa-trash"></i></button>
                    </div>
                </div>
            }
        </div>
        <input type="text" id="textUpdatedById" class="form-control" hidden value="@_userSession.UserId" />
    </div>
    <div class="card-body">
        <div class="listjs-table">
            <div class="table-responsive">
                <div class="col-sm-12 col-md-6">
                    <div id="tasksTableData_filter" class="dataTables_filter">@* <label>Search:<input type="search" class="form-control form-control-sm" placeholder="" aria-controls="tasksTableData"></label> *@</div>
                </div>
                <table id="tasksTableData" class="table table-bordered dt-responsive nowrap table-striped align-middle dataTable no-footer dtr-inline">
                    <thead class="table-light text-muted text-center">
                        <tr>
                            <th>UserName</th>
                            <th>TaskTitle</th>
                            <th>TaskDetails</th>
                            <th>TaskType</th>
                            <th>TaskDate</th>
                            <th>TaskEndDate</th>
                            <th>TaskStatus</th>
                        </tr>
                    </thead>
                    <tbody> </tbody>
                </table>
                <!-- end table -->
                <div class="noresult" style="display: none">
                    <div class="text-center">
                        <lord-icon src="https://cdn.lordicon.com/msoeawqm.json" trigger="loop" colors="primary:#25a0e2,secondary:#00bd9d" style="width:75px;height:75px">
                        </lord-icon>
                        <h5 class="mt-2">Sorry! No Result Found</h5>
                        <p class="text-muted mb-0">
                            We've searched more than 150+ invoices We did not find any
                            invoices for you search.
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <!-- container-fluid -->
        <!-- Modal -->
        <div class="modal fade zoomIn" id="addtasks" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class=" modal-dialog modal-dialog-centered modal-lg">
                <div class="modal-content">
                    <div class="modal-header bg-primary-subtle p-3">
                        <h5 class="modal-title" id="exampleModalLabel">Create Deals</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="frmtaskdetails">
                            <div class="mb-3">
                                <label for="taskType" class="form-label">Task Type</label>
                                <select class="form-control" id="taskType" name="taskType">
                                    <option selected disabled value=""></option>
                                </select>
                                <input type="hidden" class="form-control" id="txtTaskType">

                            </div>

                            <div class="mb-3">
                                <label class="form-label">Task Title</label>
                                <input type="text" id="dealTitle" class="form-control" name="dealTitle" placeholder="Enter title" />
                            </div>

                            <div class="mb-3">
                                <label for="ddlusername" class="form-label">Task ProvideTo</label>
                                <select class="form-control" id="ddlusername" name="ddlusername">
                                    <option selected disabled value=""></option>
                                </select>
                                <input type="hidden" class="form-control" id="txtguserid">

                            </div>
                            <div class="mb-3">
                                <label for="dueDate" class="form-label">Task Start-Date</label>
                                <input type="datetime-local" class="form-control material_blue" id="txtdatetime" name="txtdatetime" />

                            </div>
                            <div class="mb-3">
                                <label for="dealEmail" class="form-label">Task End-Date</label>
                                <input type="datetime-local" class="form-control material_blue" id="txtenddatetime" name="txtenddatetime">

                            </div>
                            <div class="mb-3">
                                <label for="contactDescription" class="form-label">Task Description</label>
                                <textarea class="form-control " id="contactDescription" rows="3" placeholder="Enter description" name="contactDescription"></textarea>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger btn-default m-1" id="close-modal" data-bs-dismiss="modal" onclick="ClearTextBox()">Close</button>
                        <button type="submit" class="btn btn-success" onclick="btnSaveTaskDetail();" id="taskDetails" value="Validate">Create</button>
                    </div>
                </div>
            </div>
        </div>
        <!--end modal-->

        <div class="modal fade zoomIn" id="UpdateTaskDetails" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-lg">
                <div class="modal-content border-0">
                    <div class="modal-header p-3 bg-primary-subtle">
                        <h5 class="modal-title" id="exampleModalLabel">Update Task</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" id="close-modal"></button>
                    </div>
                    <form class="tablelist-form" autocomplete="off" id="UpdateDetailsForm">
                        <div class="modal-body">
                            <input type="hidden" id="tasksId" />
                            <div class="row g-3">
                                <div class="col-lg-12">
                                    <label for="projectName-field" class="form-label">UserName</label>
                                    <input type="text" id="EditUserName" class="form-control" readonly />
                                    <input type="text" id="EditId" class="form-control" hidden />
                                </div>
                                <!--end col-->
                                <div class="col-lg-12">
                                    <div>
                                        <label for="TaskTitle" class="form-label">TaskTitle</label>
                                        <input type="text" id="EditTaskTitle" class="form-control" required />
                                        <span id="ValidateTaskTitle" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-lg-12">
                                    <div>
                                        <label for="TaskDescription" class="form-label">Description</label>
                                        <input type="text" id="EditDescription" class="form-control" required />
                                        <span id="ValidateDescription" class="text-danger"></span>
                                    </div>
                                </div>
                                <!--end col-->
                                <div class="col-lg-6">
                                    <label for="TaskDate" class="form-label">Start Date</label>
                                    <input type="date" id="EditStartDate" class="form-control" required />
                                    <span id="ValidateStartDate" class="text-danger"></span>
                                </div>
                                <!--end col-->
                                <div class="col-lg-6">
                                    <label for="TaskEndDate" class="form-label">Due Date</label>
                                    <input type="date" id="EditEndDate" class="form-control" data-provider="flatpickr" placeholder="Due date" required />
                                    <span id="ValidateEndDate" class="text-danger"></span>
                                </div>
                                <!--end col-->
                                <div class="col-lg-6">
                                    <label for="TaskStatus" class="form-label">Status</label>
                                    <select class="form-control" id="EditStatus">
                                        <option value="Pending">Pending</option>
                                        <option value="Working">Working</option>
                                        <option value="Completed">Completed</option>
                                        <option value="InReview">InReview</option>

                                    </select>
                                </div>
                                <!--end col-->
                                <div class="col-lg-6">
                                    <select class="form-control" id="EditTaskType" hidden>
                                        <option value="HighPriority">HighPriority</option>
                                        <option value="MediumPriority">MediumPriority</option>
                                        <option value="LowPriority">LowPriority</option>
                                    </select>
                                    <input id="EditTaskTypeId" class="form-control" hidden />
                                </div>
                                <!--end col-->
                            </div>
                            <!--end row-->
                        </div>
                        <div class="modal-footer">
                            <div class="hstack gap-2 justify-content-end">
                                <button type="button" class="btn btn-danger btn-default m-1" id="close-modal" data-bs-dismiss="modal">Close</button>
                                <button type="button" class="btn btn-primary" onclick="UpdateTaskDetails()" id="add-btn">Update Task</button>
                                <!-- <button type="button" class="btn btn-success" id="edit-btn">Update Task</button> -->
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <!--end modal-->
        <div class="modal fade zoomIn" id="showDetailsModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-lg">
                <div class="modal-content border-0">
                    <div class="modal-header p-3 bg-primary-subtle">
                        <h5 class="modal-title" id="exampleModalLabel">Task Details</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" id="close-modal"></button>
                    </div>
                    <form class="tablelist-form" autocomplete="off">
                        <div class="modal-body">
                            <div class="row g-3">
                                <div class="col-lg-12">
                                    <label for="projectName-field" class="form-label">UserName</label>
                                    <span id="UserName" class="form-control"></span>
                                </div>
                                <!--end col-->
                                <div class="col-lg-12">
                                    <div>
                                        <label for="TaskTitle" class="form-label">TaskTitle</label>
                                        <span id="taskTitle-field" class="form-control"></span>
                                    </div>
                                </div>
                                <!--end col-->
                                <div class="col-lg-12">
                                    <label for="TaskDescription" class="form-label">Description</label>
                                    <textarea class="form-control " id="taskDescription-field" rows="3" readonly></textarea>
                                </div>
                                <!--end col-->
                                <div class="col-lg-6">
                                    <label for="TaskDate" class="form-label">Start Date</label>
                                    <span id="taskstartdate-field" class="form-control"> </span>
                                </div>
                                <!--end col-->
                                <div class="col-lg-6">
                                    <label for="TaskEndDate" class="form-label">Due Date</label>
                                    <span id="taskenddate-field" class="form-control"></span>
                                </div>
                                <!--end col-->
                                <div class="col-lg-6">
                                    <label for="TaskPriority" class="form-label">TaskType</label>
                                    <span id="taskpriority-field" class="form-control"></span>
                                </div>
                                <!--end col-->
                                <div class="col-lg-6">
                                    <label for="TaskStatus" class="form-label">Status</label>
                                    <span id="taskstatus-field" class="form-control"></span>
                                </div>
                                <!--end col-->
                            </div>
                            <!--end row-->
                        </div>
                        <div class="modal-footer">
                            <div class="hstack gap-2 justify-content-end">
                                <button type="button" class="btn btn-danger btn-default m-1" id="close-modal" data-bs-dismiss="modal">Close</button>
                                <!-- <button type="submit" class="btn btn-success" id="add-btn">Add Task</button> -->
                                <!-- <button type="button" class="btn btn-success" id="edit-btn">Update Task</button> -->
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <!--end modal-->
    </div>
</div>


<!--end row-->

<div class="modal fade flip" id="deleteOrder" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body p-5 text-center">
                <lord-icon src="https://cdn.lordicon.com/gsqxdxog.json" trigger="loop" colors="primary:#25a0e2,secondary:#00bd9d" style="width:90px;height:90px"></lord-icon>
                <div class="mt-4 text-center">
                    <h4>You are about to delete a task ?</h4>
                    <p class="text-muted fs-14 mb-4">
                        Deleting your task will remove all of
                        your information from our database.
                    </p>
                    <div class="hstack gap-2 justify-content-center remove">
                        <button class="btn btn-link btn-ghost-primary fw-medium text-decoration-none" id="deleteRecord-close" data-bs-dismiss="modal"><i class="ri-close-line me-1 align-middle"></i> Close</button>
                        <button class="btn btn-primary" id="delete-record">Yes, Delete It</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!--end delete modal -->

<script type="text/javascript">
    var userPermissions = '@Html.Raw(Json.Serialize(UserSession.FormPermisionData))';
</script>

<script src="~/lib/jquery/dist/jquery.min.js"></script>
<script src="~/moduls/taskscript.js" asp-append-version="true"></script>