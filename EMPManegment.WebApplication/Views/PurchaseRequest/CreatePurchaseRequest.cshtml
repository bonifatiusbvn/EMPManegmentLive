@model EMPManegment.EntityModels.ViewModels.Purchase_Request.PurchaseRequestMasterView
@using EMPManegment.Web.Models;
@inject IHttpContextAccessor Accessor;
@inject UserSession _userSession
@{
    ViewData["Title"] = "CreatePurchaseRequest";
    Layout = "~/Views/Shared/_HomeLayout.cshtml";
}

<!-- start page title -->
<div class="row" style="margin-top:80px;">
    <div class="col-12">
        <div class="page-title-box d-sm-flex align-items-center justify-content-between">
            <h4 class="mb-sm-0"> Create Purchase Request</h4>
            <div class="page-title-right">
                <ol class="breadcrumb m-0">
                    <li class="breadcrumb-item"><a href="javascript: void(0);">Purchase Request</a></li>
                    <li class="breadcrumb-item active">Create Purchase Request</li>
                </ol>
            </div>
        </div>
    </div>
</div>
<input type="hidden" id="txtProjectId" value="@UserSession.ProjectId" />
<!-- end page title -->
<div class="row">
    <div class="col-xl-9">
        <div class="card">
            <div class="card-header">
                <div class="row align-items-center gy-3">
                    <div class="col-sm">
                        # @ViewData["PrNo"] <h5 class="fs-14 mb-0" id="cartTotalItemCount"></h5>
                    </div>
                    <div class="col-sm-auto">
                        <div class="d-flex gap-1 flex-wrap">
                            @{
                                string formattedDate = Model.PrDate.HasValue ? Model.PrDate.Value.ToString("yyyy-MM-dd") : "";
                            }
                            @if (Model.PrDate == null)
                            {
                                <input type="date" class="form-control" id="txtPrDate" style="width:200px;" value="@DateTime.Now.ToString("yyyy-MM-dd")" />
                            }
                            else
                            {
                                <input type="date" class="form-control" id="txtUpdatePrDate" style="width:200px;" value="@formattedDate" />
                            }                  
                            <a class="btn btn-warning" onclick="fn_OpenAddproductmodal()"><i class="ri-add-line align-bottom me-1"></i> Add Product</a>
                            <input type="text" class="form-control" id="prNo" value="@ViewData["PrNo"].ToString()" hidden />
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div class="table-responsive table-card">
                    @if (Model.PRList != null)
                    {
                        <div id="displayPurchaseRequest">
                            @Html.Partial("_AddProductPRPartial.cshtml", Model.PRList)
                        </div>
                    }
                    else
                    {
                        <div id="displayPurchaseRequest">
                        </div>
                    }
                </div>
                <div class="text-end mb-4">
                    @if (Model.PRList != null)
                    {
                        <a id="btnpurchaserequest" onclick="UpdatePurchaseRequestDetails()" class="btn btn-success btn-lg" style="margin-bottom: -30px;margin-right: 15px;width: 160px;height: 50px;">Update<i class="ri-arrow-right-line label-icon align-bottom fs-16 ms-2"></i></a>
                    }
                    else
                    {
                        <a id="btnpurchaserequest" onclick="CreatePurchaseRequest()" class="btn btn-success btn-lg" style="display: none; margin-bottom: -30px;margin-right: 15px;width: 160px;height: 50px;">Create<i class="ri-arrow-right-line label-icon align-bottom fs-16 ms-2"></i></a>
                    }
                </div>
            </div>
        </div>
        <!--end card-->
        <!--end card-->
    </div>
    <!--end col-->
    <div class="col-xl-3">
        <div class="card">
            <div class="card-header">
                <div class="d-flex">
                    <h5 class="card-title flex-grow-1 mb-0"><i class="mdi mdi-truck-fast-outline align-middle me-1 text-muted"></i>Order Summary</h5>
                </div>
            </div>
            <div class="card-body">
                <table class="table table-borderless mb-0">
                    <tbody>
                        <tr>
                            <td>Sub Total :</td>
                            <td class="text-end" id="cart-subtotal"></td>
                        </tr>
                        <tr>
                            <td>GST : </td>
                            <td class="text-end" id="cart-Gst"></td>
                        </tr>
                        <tr class="table-active">
                            <th>Total  :</th>
                            <td class="text-end">
                                <span class="fw-semibold" id="cart-total"></span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <!--end card-->
    </div>
    <!--end col-->
</div>

<!-- end card -->
<div class="modal fade show" tabindex="-1" id="mdPoproductModal" role="dialog" aria-labelledby="myLargeModalLabel" aria-modal="true" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Select Product</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" onclick="clearProductListSearchText()"></button>
            </div>
            <div class="modal-header">
                <label class="form-label">Search Product</label>
                <input class="form-control" id="mdProductSearch" onkeyup="fn_filterallProducts()"  />
            </div>
            <div class="modal-body" id="mdlistofItem" style="overflow-x: hidden">
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    var userPermissions = '@Html.Raw(Json.Serialize(UserSession.FormPermisionData))';
</script>

<script src="~/lib/jquery/dist/jquery.min.js"></script>
<script src="~/moduls/purchaserequestscript.js" asp-append-version="true"></script>

