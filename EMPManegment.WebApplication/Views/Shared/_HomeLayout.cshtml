@using EMPManegment.Web.Models;
@inject IHttpContextAccessor Accessor;
@inject UserSession _userSession
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bonifatius | ERP</title>
    <link href="~/assets/css/bootstrap.min.css" rel="stylesheet" />
    <!-- Google Font: Source Sans Pro -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="~/lteassets/plugins/fontawesome-free/css/all.min.css">
    <link href="~/assets/css/icons.min.css" rel="stylesheet" type="text/css" />
    <!-- overlayScrollbars -->
    <link rel="stylesheet" href="~/lteassets/plugins/overlayScrollbars/css/OverlayScrollbars.min.css">
    <!-- Theme style -->
    <link href="~/lteassets/dist/css/site.css" rel="stylesheet" />
    <link rel="stylesheet" href="~/lteassets/dist/css/adminlte.min.css">
    <link href="~/assets/css/app.min.css" rel="stylesheet" />
    <link href="~/assets/css/custom.min.css" rel="stylesheet" type="text/css" />
    <link href="~/assets/libs/sweetalert2/sweetalert2.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.3/themes/base/jquery-ui.css">
    <!-- Toastr -->
    <!-- Ekko Lightbox -->
    <link rel="stylesheet" href="~/lteassets/plugins/ekko-lightbox/ekko-lightbox.css">
    <link rel="stylesheet" href="~/lteassets/plugins/toastr/toastr.min.css">
    <link href="~/lteassets/plugins/select2/css/select2.min.css" rel="stylesheet" />
    <link href="~/lteassets/plugins/select2-bootstrap4-theme/select2-bootstrap4.css" rel="stylesheet" />
    <!-- DataTables -->
    <link rel="stylesheet" href="~/lteassets/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" href="~/lteassets/plugins/datatables-responsive/css/responsive.bootstrap4.min.css">
    <link rel="stylesheet" href="~/lteassets/plugins/datatables-buttons/css/buttons.bootstrap4.min.css">
    <!-- Theme style -->
    <style>
        .icon {
            margin-right: 6px;
        }

        .text {
            display: inline;
            margin: 0;
        }

        .nav-treeview {
            display: none;
        }


        .ui-autocomplete {
            z-index: 1051;
            max-height: 150px;
            overflow-y: auto;
            overflow-x: hidden;
        }
    </style>
</head>
<body class="hold-transition sidebar-mini layout-fixed layout-navbar-fixed layout-footer-fixed accent-info">
    <div class="wrapper">

        <!-- Navbar -->
        <nav class="main-header navbar navbar-expand navbar-white navbar-light" style="height:60px;">
            <!-- Left navbar links -->
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="btn btn-sm px-3 fs-16 header-item vertical-menu-btn topnav-hamburger" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
                </li>
            </ul>
            <div class="col-lg-4 col-3" style="width:250px">
                <form id="frmdrpdashbord">
                    @if (_userSession.UserRoll == "Employee")
                    {
                        <div class="btn-group">
                            <button type="button" class="btn btn-info form-select" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="true" style="width:280px;">
                                --Selected Project--
                            </button>
                            <div class="dropdown-menu" id="drpUserProjectListMenu">
                                <a class="dropdown-item" href="#" data-value="">--Selected Project--</a>
                            </div>
                        </div>
                        <select class="form-select-lg border-0" id="drpUserProjectList" style="display:none;">
                            <option selected value="">--Selected Project--</option>
                        </select>

                    }
                    else
                    {
                        <div class="btn-group">
                            <button type="button" class="btn btn-info form-select" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="true" style="width:280px;">
                                --All Projects--
                            </button>
                            <div class="dropdown-menu" id="drpUserProjectListMenu">
                                <a class="dropdown-item" href="#" data-value="">--All Projects--</a>
                            </div>
                        </div>

                        <select class="form-select-lg border-0" id="drpProjectName" style="display:none;">
                            <option selected value="">--All Project--</option>
                        </select>

                    }
                </form>
            </div>
            @{
                var profilePhoto = UserSession.ProfilePhoto;
                var fullName = _userSession.FullName;
                var firstNameInitial = !string.IsNullOrEmpty(_userSession.FirstName) ? _userSession.FirstName[0].ToString() : string.Empty;
                var lastNameInitial = !string.IsNullOrEmpty(_userSession.LastName) ? _userSession.LastName[0].ToString() : string.Empty;
                var initials = (firstNameInitial + lastNameInitial).ToUpper();
                var defaultImagePath = "~/content/image/image-b2.jpg";
            }
            <!-- Right navbar links -->
            <ul class="navbar-nav ml-auto">
                <li class="nav-item dropdown">
                    <div class="dropdown ms-sm-3 header-item topbar-user" style="height:60px;">
                        <button type="button" class="btn" id="page-header-user-dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <span class="d-flex align-items-center ">
                                @if (!string.IsNullOrEmpty(profilePhoto) && !profilePhoto.Equals(defaultImagePath, StringComparison.OrdinalIgnoreCase))
                                {
                                    <img src="~/@profilePhoto" style="height:40px;width:40px;" alt="message user image" class="img-circle img-bordered-sm">
                                }
                                else
                                {
                                    <div class="flex-shrink-0 avatar-xs me-2">
                                        <div class="avatar-title bg-success-subtle text-success rounded-circle fs-13" style="height:40px;width:40px;">@initials</div>
                                    </div>
                                }
                                <span class="text-start ms-xl-2">
                                    <span class="d-none d-xl-inline-block ms-1 fw-medium d-block">@_userSession.FullName</span>
                                    <span class="d-none d-xl-block ms-1 fs-12 d-block">@_userSession.UserName</span>

                                </span>
                            </span>
                        </button>
                        <input type="hidden" value="@_userSession.UserId" />
                        <div class="dropdown-menu dropdown-menu-end" style="position: absolute; inset: 0px 0px auto auto; margin: 0px; transform: translate(0px, 66px);">
                            <!-- item-->
                            <h6 class="dropdown-header">Welcome @_userSession.FirstName!</h6>
                            <a asp-action="UserProfile" asp-controller="UserProfile" class="dropdown-item">
                                <i class="fas fa-user-circle"></i> Profile
                            </a>

                            <a asp-action="UserTasks" asp-controller="Task" class="dropdown-item">
                                <i class="fa-solid fa-list-check"></i> Taskboard
                            </a>

                            <a asp-action="LockScreen" asp-controller="UserProfile" class="dropdown-item">
                                <i class="fa-solid fa-user-lock"></i> Lock screen
                            </a>
                            <button onclick="UserLogout()" class="dropdown-item">
                                <i class="fa-solid fa-right-from-bracket"></i> Logout
                            </button>
                        </div>
                    </div>
                </li>


            </ul>
        </nav>
        <!-- /.navbar -->
        <!-- Main Sidebar Container -->
        <aside class="main-sidebar elevation-4 sidebar-dark-info">
            <!-- Brand Logo -->
            <a asp-action="UserHome" asp-controller="Home" class="brand-link">
                <img src="~/assets/images/bonifatiusicon.ico" alt="AdminLTE Logo" class="brand-image img-circle elevation-3" style="opacity: .8">
                <span class="brand-text font-weight-light">Bonifatius ERP</span>
            </a>

            <!-- Sidebar -->
            <div class="sidebar">
                <!-- Sidebar Menu -->
                <nav class="mt-2">
                    <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
                        @foreach (var group in UserSession.FormPermisionData.Select(a => a.GroupName).Distinct())
                        {
                            var groupData = UserSession.FormPermisionData.Where(e => e.GroupName == group && e.isActive == true).ToList();
                            var hasViewPermission = groupData.Any(e => e.isViewAllow == true);

                            @if (group == "Dashboard" && groupData.Count > 0)
                            {
                                @foreach (var item in groupData)
                                {
                                    <li class="nav-item">
                                        <a asp-action="@item.Action" asp-controller="@item.Controller" class="nav-link">
                                            <i class="nav-icon fas fa-tachometer-alt icon"></i>
                                            <p class="text">
                                                Dashboard
                                            </p>
                                        </a>
                                    </li>
                                }
                            }
                            else if (group == "Projects" && hasViewPermission)
                            {
                                <li class="nav-item">
                                    <a href="#" class="nav-link">
                                        <i class="fa-regular fa-file-lines icon"></i>
                                        <p class="text">
                                            Projects
                                            <i class="right fas fa-angle-left"></i>
                                        </p>
                                    </a>

                                    <ul class="nav nav-treeview" style="display: none;">
                                        @foreach (var item in groupData)
                                        {
                                            @if (item.View)
                                            {
                                                <li class="nav-item">
                                                    <a asp-action="@item.Action" asp-controller="@item.Controller" class="nav-link">
                                                        <i class="far fa-circle nav-icon"></i>
                                                        <p>@item.FormName</p>
                                                    </a>
                                                </li>
                                            }
                                        }
                                    </ul>
                                </li>
                            }
                            else if (group == "Product Master" && hasViewPermission)
                            {
                                <li class="nav-item">
                                    <a href="#" class="nav-link">
                                        <i class="fa-solid fa-cart-shopping icon"></i>
                                        <p class="text">
                                            Product Master
                                            <i class="right fas fa-angle-left"></i>
                                        </p>
                                    </a>
                                    <ul class="nav nav-treeview" style="display: none;">
                                        @foreach (var item in groupData)
                                        {
                                            @if (item.View)
                                            {
                                                <li class="nav-item">
                                                    <a asp-action="@item.Action" asp-controller="@item.Controller" class="nav-link">
                                                        <i class="far fa-circle nav-icon"></i>
                                                        <p>@item.FormName</p>
                                                    </a>
                                                </li>
                                            }
                                        }
                                    </ul>
                                </li>
                            }
                            else if (group == "Expense" && hasViewPermission)
                            {
                                <li class="nav-item">
                                    <a href="#" class="nav-link">
                                        <i class="fa-solid fa-coins icon"></i>
                                        <p class="text">
                                            Expense
                                            <i class="right fas fa-angle-left"></i>
                                        </p>
                                    </a>
                                    <ul class="nav nav-treeview" style="display: none;">
                                        @foreach (var item in groupData)
                                        {
                                            @if (item.View)
                                            {
                                                <li class="nav-item">
                                                    <a asp-action="@item.Action" asp-controller="@item.Controller" class="nav-link">
                                                        <i class="far fa-circle nav-icon"></i>
                                                        <p>@item.FormName</p>
                                                    </a>
                                                </li>
                                            }
                                        }
                                    </ul>
                                </li>
                            }
                            else if (group == "InvoicesManual" && hasViewPermission)
                            {
                                <li class="nav-item">
                                    <a href="#" class="nav-link">
                                        <i class="fa-solid fa-newspaper icon"></i>
                                        <p class="text">
                                            InvoicesManual
                                            <i class="right fas fa-angle-left"></i>
                                        </p>
                                    </a>
                                    <ul class="nav nav-treeview" style="display: none;">
                                        @foreach (var item in groupData)
                                        {
                                            @if (item.View)
                                            {
                                                <li class="nav-item">
                                                    <a asp-action="@item.Action" asp-controller="@item.Controller" class="nav-link">
                                                        <i class="far fa-circle nav-icon"></i>
                                                        <p>@item.FormName</p>
                                                    </a>
                                                </li>
                                            }
                                        }
                                    </ul>
                                </li>
                            }
                            else if (group == "User" && hasViewPermission)
                            {
                                <li class="nav-item">
                                    <a href="#" class="nav-link">
                                        <i class="fa-solid fa-user icon"></i>
                                        <p class="text">
                                            User
                                            <i class="right fas fa-angle-left"></i>
                                        </p>
                                    </a>
                                    <ul class="nav nav-treeview" style="display: none;">
                                        @foreach (var item in groupData)
                                        {
                                            @if (item.View)
                                            {
                                                <li class="nav-item">
                                                    <a asp-action="@item.Action" asp-controller="@item.Controller" class="nav-link">
                                                        <i class="far fa-circle nav-icon"></i>
                                                        <p>@item.FormName</p>
                                                    </a>
                                                </li>
                                            }
                                        }
                                    </ul>
                                </li>
                            }
                            else if (group == "Authentication" && hasViewPermission)
                            {
                                <li class="nav-item">
                                    <a href="#" class="nav-link">
                                        <i class="fa-solid fa-key icon"></i>
                                        <p class="text">
                                            Authentication
                                            <i class="right fas fa-angle-left"></i>
                                        </p>
                                    </a>
                                    <ul class="nav nav-treeview" style="display: none;">
                                        @foreach (var item in groupData)
                                        {
                                            @if (item.View)
                                            {
                                                <li class="nav-item">
                                                    <a asp-action="@item.Action" asp-controller="@item.Controller" class="nav-link">
                                                        <i class="far fa-circle nav-icon"></i>
                                                        <p>@item.FormName</p>
                                                    </a>
                                                </li>
                                            }
                                        }
                                    </ul>
                                </li>
                            }
                            else if (group == "Vendor" && hasViewPermission)
                            {
                                <li class="nav-item">
                                    <a href="#" class="nav-link">
                                        <i class="fa-solid fa-truck icon"></i>
                                        <p class="text">
                                            Vendor
                                            <i class="right fas fa-angle-left"></i>
                                        </p>
                                    </a>
                                    <ul class="nav nav-treeview" style="display: none;">
                                        @foreach (var item in groupData)
                                        {
                                            @if (item.View)
                                            {
                                                <li class="nav-item">
                                                    <a asp-action="@item.Action" asp-controller="@item.Controller" class="nav-link">
                                                        <i class="far fa-circle nav-icon"></i>
                                                        <p>@item.FormName</p>
                                                    </a>
                                                </li>
                                            }
                                        }
                                    </ul>
                                </li>
                            }
                            else if (group == "Payment Transaction" && hasViewPermission)
                            {
                                <li class="nav-item">
                                    <a href="#" class="nav-link">
                                        <i class="fa-regular fa-credit-card icon"></i>
                                        <p class="text">
                                            Payment Transaction
                                            <i class="right fas fa-angle-left"></i>
                                        </p>
                                    </a>
                                    <ul class="nav nav-treeview" style="display: none;">
                                        @foreach (var item in groupData)
                                        {
                                            @if (item.View)
                                            {
                                                <li class="nav-item">
                                                    <a asp-action="@item.Action" asp-controller="@item.Controller" class="nav-link">
                                                        <i class="far fa-circle nav-icon"></i>
                                                        <p>@item.FormName</p>
                                                    </a>
                                                </li>
                                            }
                                        }
                                    </ul>
                                </li>
                            }
                            else if (group == "Purchase Request" && hasViewPermission)
                            {
                                <li class="nav-item">
                                    <a href="#" class="nav-link">
                                        <i class="fa-solid fa-bag-shopping icon"></i>
                                        <p class="text">
                                            Purchase Request
                                            <i class="right fas fa-angle-left"></i>
                                        </p>
                                    </a>
                                    <ul class="nav nav-treeview" style="display: none;">
                                        @foreach (var item in groupData)
                                        {
                                            @if (item.View)
                                            {
                                                <li class="nav-item">
                                                    <a asp-action="@item.Action" asp-controller="@item.Controller" class="nav-link">
                                                        <i class="far fa-circle nav-icon"></i>
                                                        <p> @item.FormName</p>
                                                    </a>
                                                </li>
                                            }
                                        }
                                    </ul>
                                </li>
                            }
                            else if (group == "Purchase Order" && hasViewPermission)
                            {
                                <li class="nav-item">
                                    <a href="#" class="nav-link">
                                        <i class="fa-regular fa-clipboard icon"></i>
                                        <p class="text">
                                            Purchase Order
                                            <i class="right fas fa-angle-left"></i>
                                        </p>
                                    </a>
                                    <ul class="nav nav-treeview" style="display: none;">
                                        @foreach (var item in groupData)
                                        {
                                            @if (item.View)
                                            {
                                                <li class="nav-item">
                                                    <a asp-action="@item.Action" asp-controller="@item.Controller" class="nav-link">
                                                        <i class="far fa-circle nav-icon"></i>
                                                        <p>@item.FormName</p>
                                                    </a>
                                                </li>
                                            }
                                        }
                                    </ul>
                                </li>
                            }
                            else if (group == "Invoices" && hasViewPermission)
                            {
                                <li class="nav-item">
                                    <a href="#" class="nav-link">
                                        <i class="fa-solid fa-newspaper icon"></i>
                                        <p class="text">
                                            Invoices
                                            <i class="right fas fa-angle-left"></i>
                                        </p>
                                    </a>
                                    <ul class="nav nav-treeview" style="display: none;">
                                        @foreach (var item in groupData)
                                        {
                                            @if (item.View)
                                            {
                                                <li class="nav-item">
                                                    <a asp-action="@item.Action" asp-controller="@item.Controller" class="nav-link">
                                                        <i class="far fa-circle nav-icon"></i>
                                                        <p>@item.FormName</p>
                                                    </a>
                                                </li>
                                            }
                                        }
                                    </ul>
                                </li>
                            }
                            else if (group == "Tasks" && hasViewPermission)
                            {
                                <li class="nav-item">
                                    <a href="#" class="nav-link">
                                        <i class="fas fa-tasks icon"></i>
                                        <p class="text">
                                            Tasks
                                            <i class="right fas fa-angle-left"></i>
                                        </p>
                                    </a>
                                    <ul class="nav nav-treeview" style="display: none;">
                                        @foreach (var item in groupData)
                                        {
                                            @if (item.View)
                                            {
                                                <li class="nav-item">
                                                    <a asp-action="@item.Action" asp-controller="@item.Controller" class="nav-link">
                                                        <i class="far fa-circle nav-icon"></i>
                                                        <p>@item.FormName</p>
                                                    </a>
                                                </li>
                                            }
                                        }
                                    </ul>
                                </li>
                            }
                        }

                    </ul>
                </nav>
            </div>

            <!-- /.sidebar -->
        </aside>

        <!-- Content Wrapper. Contains page content -->
        <div class="content-wrapper">
            <!-- Main content -->
            <section class="content">
                <div class="container-fluid">
                    <partial name="_Loader" />
                    @RenderBody()
                </div>
            </section>
        </div>
        <!-- end .h-100-->
        <aside class="control-sidebar control-sidebar-dark">
            <!-- Control sidebar content goes here -->
        </aside>
        <!-- /.control-sidebar -->
        <!-- Main Footer -->
        <footer class="main-footer">

            <div class="float-right d-none d-sm-inline-block">
            </div>
        </footer>
    </div>
    <!-- ./wrapper -->
    <!-- REQUIRED SCRIPTS -->
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
    <script src="~/lib/jquery-validation/dist/jquery.validate.js"></script>
    <!-- Bootstrap -->
    <script src="~/lteassets/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="~/lteassets/plugins/select2/js/select2.min.js"></script>
    <script src="~/lteassets/plugins/moment/moment.min.js"></script>
    <script src="https://code.jquery.com/ui/1.13.3/jquery-ui.js"></script>
    <!-- overlayScrollbars -->
    <script src="~/lteassets/plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js"></script>
    <!-- AdminLTE App -->

    <script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
    <script src="~/lib/jquery-validation/dist/jquery.validate.js"></script>
    <!-- Sweet Alerts js -->
    <!--datatable js-->
    <script src="~/cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="~/cdn.datatables.net/1.11.5/js/dataTables.bootstrap5.min.js"></script>
    <script src="~/cdn.datatables.net/responsive/2.2.9/js/dataTables.responsive.min.js"></script>
    <script src="~/cdn.datatables.net/buttons/2.2.2/js/dataTables.buttons.min.js"></script>
    <script src="~/cdn.datatables.net/buttons/2.2.2/js/buttons.print.min.js"></script>
    <script src="~/cdn.datatables.net/buttons/2.2.2/js/buttons.html5.min.js"></script>
    <script src="~/cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
    <script src="~/cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
    <script src="~/cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>


    <!-- jQuery Mapael -->
    <script src="~/lteassets/plugins/jquery-mousewheel/jquery.mousewheel.js"></script>
    <script src="~/lteassets/plugins/raphael/raphael.min.js"></script>
    <script src="~/lteassets/plugins/jquery-mapael/jquery.mapael.min.js"></script>
    <script src="~/lteassets/plugins/jquery-mapael/maps/usa_states.min.js"></script>
    <!-- ChartJS -->
    <script src="~/lteassets/plugins/chart.js/Chart.min.js"></script>

    <!-- AdminLTE for demo purposes -->
    <script src="~/moduls/common.js" asp-append-version="true"></script>
    <script src="~/moduls/masterlistscript.js" asp-append-version="true"></script>
    <!-- init js -->
    <script src="~/moduls/layoutscript.js" asp-append-version="true"></script>
    <script src="~/lteassets/dist/js/adminlte.js"></script>
    <!-- Loader -->
    <!-- SweetAlert2 -->
    <script src="~/assets/libs/sweetalert2/sweetalert2.min.js"></script>
    <script src="https://cdn.lordicon.com/lusqsztk.js"></script>
    <!-- Toastr -->
    <script src="~/lteassets/plugins/toastr/toastr.min.js"></script>
    <!-- App js -->
    <script src="~/js/loader.js" asp-append-version="true"></script>

    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>


<script lang="ts" setup type="text/javascript">

    var UserId = '@_userSession.UserId';
    var TodayDate = '@DateTime.Today';


    var Role = "@_userSession.UserRoll";

    if (Role == "Employee") {
        UserProjectList();
    }
    else {
        ProjectListDrp();
    }

    function UserProjectList() {
        $.ajax({
            url: '/Project/GetUserProjectLists',
            success: function (result) {
                var $projectMenu = $("#drpUserProjectListMenu");
                var $hiddenDropdown = $("#drpUserProjectList");
                $projectMenu.empty();
                $hiddenDropdown.empty();

                $projectMenu.append('<a class="dropdown-item" href="#" data-value="">--Selected Project--</a>');
                $hiddenDropdown.append('<option selected value="">--Selected Project--</option>');

                $.each(result, function (i, data) {
                    $projectMenu.append('<a class="dropdown-item" href="#" data-value="' + data.projectId + '">' + data.projectTitle + ' (' + data.shortName + ')</a>');
                    $hiddenDropdown.append('<option value="' + data.projectId + '">' + data.projectTitle + ' (' + data.shortName + ')</option>');
                });

                var selectUserProjectId = sessionStorage.getItem('SelectedUserProjectId');
                if (selectUserProjectId) {
                    $('#drpUserProjectList').val(selectUserProjectId).trigger('change');
                    $('.btn-group .btn').text($('#drpUserProjectList option:selected').text());
                }

                $('#drpUserProjectListMenu .dropdown-item').click(function () {
                    var selectedProjectId = $(this).data('value');
                    var ProjectText = $(this).text();

                    $('.btn-group .btn').text(ProjectText);
                    $('#drpUserProjectList').val(selectedProjectId).trigger('change');
                    sessionStorage.setItem('SelectedUserProjectId', selectedProjectId);
                });
            }
        });
    }

    $('#drpUserProjectList').change(function () {
        var ProjectText = $(this).find('option:selected').text();
        var selectedProjectId = $(this).val();

        if (selectedProjectId == "") {
            ProjectText = " ";
        }


        fn_ChangeProject(selectedProjectId, ProjectText);
        sessionStorage.setItem('SelectedProjectId', selectedProjectId);
    });


    function ProjectListDrp() {
        $.ajax({
            url: '/Project/GetUserProjectLists',
            success: function (result) {
                var $projectMenu = $("#drpUserProjectListMenu");
                var $hiddenDropdown = $("#drpProjectName");
                $projectMenu.empty();
                $hiddenDropdown.empty();

                $projectMenu.append('<a class="dropdown-item" href="#" data-value="">--All Projects--</a>');
                $hiddenDropdown.append('<option selected value="">--All Projects--</option>');

                $.each(result, function (i, data) {
                    $projectMenu.append('<a class="dropdown-item" href="#" data-value="' + data.projectId + '">' + data.projectTitle + ' (' + data.shortName + ')</a>');
                    $hiddenDropdown.append('<option value="' + data.projectId + '">' + data.projectTitle + ' (' + data.shortName + ')</option>');
                });

                var selectUserProjectId = sessionStorage.getItem('SelectedUserProjectId');
                if (selectUserProjectId) {
                    $('#drpProjectName').val(selectUserProjectId).trigger('change');
                    $('.btn-group .btn').text($('#drpProjectName option:selected').text());
                }

                $('#drpUserProjectListMenu .dropdown-item').click(function () {
                    var selectedProjectId = $(this).data('value');
                    var ProjectText = $(this).text();

                    $('.btn-group .btn').text(ProjectText);
                    $('#drpProjectName').val(selectedProjectId).trigger('change');
                    sessionStorage.setItem('SelectedUserProjectId', selectedProjectId);
                });
            }
        });
    }


    $('#drpProjectName').change(function () {
        var ProjectText = $(this).find('option:selected').text();
        var selectedProjectId = $(this).val();

        if (selectedProjectId == "") {
            ProjectText = " ";
        }


        fn_ChangeProject(selectedProjectId, ProjectText);
        sessionStorage.setItem('SelectedProjectId', selectedProjectId);
    });


    function fn_ChangeProject(selectedProjectId, ProjectText) {
        $.ajax({
            url: '/Home/ProjectList',
            type: 'GET',
            data: {
                ProjectId: selectedProjectId,
                ProjectName: ProjectText,
            },
            success: function (result) {

            },
        });

    }

</script>

